<!DOCTYPE html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
    <link rel="stylesheet" type="text/css" href="twitter.css">
    <title>News from Twitter</title>
    <style>
      html, body { height: 80%; width: 80%; }
    </style>
  </head>

  <body>
    <h1>Twitter: </h1>
    <ul>
      <div class="twitter"></div>
    </ul>

    <script>
    window.onload = function() {
      socket = new WebSocket("ws://127.0.0.1:8081");
	    socket.onmessage = function(event) {
        tweet = JSON.parse(event.data);

        // image
        if(tweet.image !== undefined) {
          $('.twitter').prepend('<div id="attached_image"><img /></div>');

          var image_url = tweet.image;
          var imgPreloader=new Image();
          imgPreloader.onload=function() { 
             $('#attached_image').children('img').attr({'src':image_url, 'height':256});
          }
          imgPreloader.src = image_url;
        }

        // Tweet
        $('.twitter').prepend('<p id="text">' + tweet.text + '</p>');

        // Screen name
        unixtime = Date.parse(tweet.date);
        var date = new Date(unixtime);
        localDate = date.toLocaleDateString();
        localtime = date.toLocaleTimeString();
        $('.twitter').prepend('<p id="user">' + localDate + " " + localtime + " @" + tweet.user + '</p>');

        // Profile image
        $('.twitter').prepend("<div id='profile'><img /></div>");
        var imgPreloader = new Image();
        imgPreloader.onload = function() {
          $('#profile').children('img').attr({'src':tweet.profile, 'height':50, 'align':'left'});
          //console.log(tweet.profile);
        }
        imgPreloader.src = tweet.profile;
	    }
    }
    </script>
  </body>
</html>